> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [sspai.com](https://sspai.com/post/76721)

> æ‰“å¼€é˜…è¯»è½¯ä»¶é‚£ä¸€åˆ»å¼€å§‹è®¡æ—¶ã€é€€å‡ºé˜…è¯»è½¯ä»¶ååœæ­¢ï¼Œè¦æƒ³å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œé™¤äº† Tasker ä½ è¿˜å¯ä»¥å€ŸåŠ© Auto.js å’Œ MacroDroid æ‰‹åŠ¨ç¼–å†™ã€‚

Don't Repeat Yourself
---------------------

é™¤äº†æ¶ˆé£å¨±ä¹ä¹‹å¤–ï¼Œé˜…è¯»é€šå¸¸ä¹Ÿæ˜¯æˆ‘ä½¿ç”¨æ‰‹æœºæœ€å¤šçš„åœºæ™¯ä¹‹ä¸€ã€‚

ç”±äºæˆ‘ä¸ªäººæœ‰è®°å½•æ—¶é—´çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥å½“æˆ‘é˜…è¯»æ—¶ä¼šæ‰‹åŠ¨åœ¨è®¡æ—¶åº”ç”¨ä¸Šå…ˆå¼€å§‹è®¡æ—¶ï¼Œç„¶åå†è¿›è¡Œé˜…è¯»ï¼Œç»“æŸä¹‹åå†æ‰‹åŠ¨åœæ­¢è®¡æ—¶å¹¶æ‰“å¡è®°å½•å½“å¤©çš„å®Œæˆæƒ…å†µã€‚

ç»è¿‡å¤šæ¬¡äººå·¥é‡å¤æ€§åœ°æ“ä½œä¹‹åï¼Œæˆ‘ä¼¼ä¹å¯¹è¿™ä¸€è¿‡ç¨‹æ„Ÿåˆ°æœ‰äº›æ¯ç‡¥å’Œä¸è€çƒ¦ï¼Œä¹Ÿä¸‹æ„è¯†æ„Ÿè§‰åˆ°è‡ªå·±è¿åäº†è½¯ä»¶å¼€å‘ä¸­ç»å…¸çš„ DRY åŸåˆ™ï¼ˆ**D**on't **R**epeat **Y**ourselfï¼‰ï¼Œäºæ˜¯æˆ‘å°±æƒ³ï¼š

> ä¸ºä»€ä¹ˆä¸èƒ½è®©æ‰‹æœºè‡ªåŠ¨åœ°ä»æˆ‘æ‰“å¼€é˜…è¯»è½¯ä»¶é‚£ä¸€åˆ»å¼€å§‹è®¡æ—¶ï¼Œåœ¨é€€å‡ºé˜…è¯»è½¯ä»¶ååœæ­¢è®¡æ—¶å‘¢ï¼Ÿ

å€ŸåŠ©æœç´¢å¼•æ“å‘ç°äº† Fairyex ä½¿ç”¨ Tasker è‡ªåŠ¨åŒ–è®°å½•æ—¶é—´çš„æ–‡ç« ä¹‹åï¼Œæˆ‘æ‰çŸ¥é“ä¸ä»…åªæœ‰æˆ‘ä¸€ä¸ªäººæœ‰è¿™æ ·çš„æƒ³æ³•ï¼›å¯è€ƒè™‘åˆ°æˆ‘æ²¡æœ‰ Tasker æ— æ³•ç›´æ¥ã€Œç…§æŠ„ä½œä¸šã€ï¼Œäºæ˜¯ç§‰æ‰¿ç€ã€Œåªè¦æ€æƒ³ä¸æ»‘å¡ï¼Œæ–¹æ³•æ€»æ¯”å›°éš¾å¤šã€æƒ³æ³•ï¼Œåœ¨ç¨åŠ å°è¯•ä¹‹åæˆ‘æ‰“ç®—ç”¨è‡ªå·± Android æ‰‹æœºä¸Šç°æœ‰çš„ä¸¤ä¸ªå·¥å…·â€”â€”Auto.js å’Œ MacroDroidâ€”â€”æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚

æ•ˆæœå¦‚ä¸‹ï¼š

![](https://cdn.sspai.com/editor/u_/cdlke55b34tcd6q36fb0)

**å…³è”é˜…è¯»ï¼š**[ç”¨ Tasker å®ç°æ—¶é—´è®°å½•è‡ªåŠ¨åŒ–](https://sspai.com/post/56699)

æˆ‘çš„å®ç°æ€è·¯
------

å®ç°è‡ªåŠ¨åŒ–æ—¶é—´è®°å½•çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯è¦é€‰æ‹©å¯ä»¥è®°å½•æ—¶é—´å¹¶ä¸”èƒ½æä¾›ç±»ä¼¼ URL Schema æˆ–ç±»ä¼¼ API æ¥å£çš„è®¡æ—¶å·¥å…·ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke5db34tcdtg9f300)

æˆ‘å’Œ Fairyex ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ [Toggl](https://track.toggl.com/timer)ï¼ˆæŒ‰ï¼šå¦‚ä»Šå·²æ›´åä¸º Toggl Trackï¼‰è¿™ä¸€æ¬¾ç®€æ´ã€æ— å¹¿å‘Šä¸”è·¨å¹³å°å·¥å…·çš„æ¥è®°å½•æ—¶é—´ï¼Œè€Œè¯¥å·¥å…·åˆæä¾›äº† [API](https://developers.track.toggl.com/docs/) æ¥å£ï¼Œæ‰€ä»¥è¯¥å·¥å…·æ˜¯è¿™æ¬¡è‡ªåŠ¨åŒ–ä¸­ç”¨ä»¥è®°å½•æ—¶é—´çš„å…³é”®ã€‚

è‡ªåŠ¨å¼€å§‹è®¡æ—¶ä¸åœæ­¢è®¡æ—¶ä¸¤ä¸ªè¿‡ç¨‹æˆ‘ä»¬éƒ½ä¼šé€šè¿‡ Toggl æä¾›çš„ API æ¥å£æ¥å®Œæˆã€‚

**å…³è”é˜…è¯»ï¼š**[æ—¶é—´é‡åŒ–ç®¡ç†ï¼šToggl çš„ä½¿ç”¨](https://sspai.com/post/44349)

ç¡®å®šäº†åŸºæœ¬çš„åˆ‡å…¥ç‚¹ä¹‹åï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤æ¯”è¾ƒæ˜ç¡®ï¼š

1.  æ£€æµ‹åˆ°ç›®æ ‡ App æ‰“å¼€åï¼šå¼€å§‹å‘ Toggl API å‘é€ HTTP è¯·æ±‚å¼€å§‹è®¡æ—¶ï¼Œå¹¶ç»™å‡ºæç¤ºæ¶ˆæ¯ï¼›
2.  ç±»ä¼¼åœ°ï¼Œæ£€æµ‹åˆ°ç›®æ ‡ App é€€å‡ºåï¼šå‘ Toggl API å†å‘é€ä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œè¡¨ç¤ºåœæ­¢è®¡æ—¶å¹¶åŒæ ·ç»™å‡ºæç¤ºæ¶ˆæ¯ï¼Œè¿›è€Œå®Œæˆä¸€æ¬¡è®°å½•ã€‚

ä¸ºä»€ä¹ˆä¸ç”¨ Tasker
------------

Fairyex çš„æ–‡ç« ä»‹ç»è¿‡ä¸€ç§å®Œå…¨ä½¿ç”¨ Tasker æ¥å®ç°è®°å½•çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œæ‰€ä»¥æœ¬è´¨ä¸Š MacroDroid ä¹Ÿèƒ½å®ç°ã€‚

**ä½†æˆ‘ä¸ªäººä¸å–œæ¬¢å¤šæ¬¡æ‹–æ‹½å¹¶åœ¨å¤šå±‚çº§ç•Œé¢ä¸­æ¥å›åˆ‡æ¢ã€‚**è€ƒè™‘åˆ°åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œå› æ­¤ä¸ Toggl API äº¤äº’çš„éƒ¨åˆ†æˆ‘ä¸»è¦ç”¨ Auto.js æ¥å®Œæˆï¼Œå®ƒå¯ä»¥è®©æˆ‘ç›´æ¥ç¼–å†™ä»£ç æ¥å‘é€ HTTP è¯·æ±‚â€”â€”æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰è¿‡ä»‹ç»ï¼ŒAuto.js æ˜¯ä¸€æ¬¾å…è®¸ç”¨æˆ·é€šè¿‡ç¼–å†™ JavaScript ä»£ç æ¥å®ç°è‡ªåŠ¨åŒ–çš„ Android åº”ç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒå®‰è£… [npm](https://www.npmjs.com/) åŒ…æ¥æ¥å…¥åºå¤§çš„ JavaScript ç”Ÿæ€èµ„æºã€‚

**å…³è”é˜…è¯»ï¼š**[è‡ªå·±åŠ¨æ‰‹å®ç° Android è‡ªåŠ¨åŒ–ï¼šç”¨ Auto.js è‡ªåŠ¨å¤åˆ¶çŸ­ä¿¡éªŒè¯ç ](https://sspai.com/post/76377)

**ä¸åŒäº Tasker æˆ– MacroDroidï¼Œåœ¨ Auto.js ä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ä»£ç ç¼–å†™æ›´ä¸ºå¤æ‚çš„æ“ä½œé€»è¾‘ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥éšæ—¶å¯¹ä»£ç è¿›è¡Œè°ƒè¯•**ã€‚æ¯”å¦‚ Toggl æä¾›äº† API æ¥å£ï¼Œé‚£ä¹ˆç”¨ç±»ä¼¼äº Tasker è¿™æ ·çš„å·¥å…·æ¥è®¿é—®è¯·æ±‚å°±éœ€è¦ç»è¿‡å¤šæ­¥ç‚¹å‡»ï¼š

![](https://cdn.sspai.com/editor/u_/cdlke5tb34tcd6q36fbg)

_é…å›¾å¼•è‡ª Fairyex æ–‡ç« _

è€Œåœ¨ä½¿ç”¨ Auto.js çš„æƒ…å†µä¸‹å°±å¯ä»¥ç•¥è¿‡å¤šæ¬¡è·³è½¬çš„è¿‡ç¨‹ï¼Œç›´æ¥é€šè¿‡æ•²å…¥ä»£ç æ¥å¿«é€Ÿæå®šï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š

```
const token = '<toggl-token>'
const api = '<toggl-api>'
const data = {
    "description": "task name"
    ...
}
http.post(api, data, {
    headers: {
        'Authorization': `Basic ${token}`
    }
})


```

ä¸è¿‡è¿™å¯èƒ½è®©ä½ ä»¥ä¸ºæ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹ä»…ä»…åªéœ€è¦è¿™æ ·ç®€å•çš„ HTTP è¯·æ±‚ä»£ç å³å¯ï¼Œä½†å…¶å®æˆ‘ä»¬è¿˜ä¼šåŠ å…¥æ›´å¤šçš„åˆ¤æ–­é€»è¾‘ï¼Œæ¯”å¦‚ï¼š

*   æ‰€åœ¨çš„å‰å°åº”ç”¨æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦è®¡æ—¶çš„ç›®æ ‡åº”ç”¨ï¼Ÿå¦‚æœä¸æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¦éœ€è¦æ“ä½œï¼Ÿ
*   å¦‚æœæˆ‘åœ¨æ¡Œé¢ç«¯å·²ç»æœ‰äº†ä¸€ä¸ª Toggl è®¡æ—¶ï¼Œåˆæˆ–è€…æ˜¯å½“å‰åº”ç”¨å·²ç»æ­£åœ¨è®¡æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ
*   â€¦â€¦

è¿™äº›åˆ¤æ–­é€»è¾‘å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦éšæ„å¢åˆ ï¼Œä½†éšç€åˆ¤æ–­é€»è¾‘çš„å¢åŠ ï¼Œå€˜è‹¥è¿˜å®Œå…¨åœ°é ç‚¹å‡»æ‹–æ‹½æ¥å¢åŠ æ›´å¤šçš„åº”å¯¹æ“ä½œæ— ç–‘æ˜¯ä¸€ä»¶åŠ³å¿ƒåŠ³åŠ›çš„äº‹æƒ…ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘æ˜¯éœ€è¦ Auto.js æ¥å®ç°ä¸»è¦æ­¥éª¤ã€‚

è‡³äºã€Œç›®æ ‡ App æ˜¯å¦æ‰“å¼€ / å…³é—­ã€çš„æ¡ä»¶æ£€æµ‹ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨ MacroDroid è¿™ä¸€æ¬¾å’Œ Tasker ç±»ä¼¼çš„è‡ªåŠ¨åŒ–å·¥å…·æ¥è¾…åŠ©ï¼Œè¯¥åº”ç”¨æä¾›çš„è§¦å‘å™¨å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå¼¥è¡¥ Auto.js ç¼ºå°‘çš„åŠŸèƒ½ã€‚å¹¶ä¸” MacroDroid è¿˜å…¼å…·åŠŸèƒ½ä¸°å¯Œã€æ˜“ä¸Šæ‰‹ä¸”æä¾›ä¸­æ–‡ç•Œé¢ç­‰ä¼˜ç‚¹ï¼Œæˆ‘åœ¨åç»­å°†ä¼šå†å†™ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»å®ƒï¼Œæ­¤å¤„æš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚

è‡³æ­¤ï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–çš„å®ç°æ€è·¯å°±è¢«æˆ‘æ¢³ç†æˆäº†å¦‚ä¸‹æµç¨‹å›¾ï¼š

![](https://cdn.sspai.com/editor/u_/cdlke65b34tcdjag47e0)

åŸºäº Auto.js ç¼–å†™å¤æ‚çš„æ“ä½œé€»è¾‘
--------------------

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„åˆ¤æ–­é€»è¾‘ï¼ŒToggl API åœ¨å¼€æºç¤¾åŒºä¸­å·²æœ‰è®¸å¤šç¬¬ä¸‰æ–¹å®ç°ï¼Œå¹¶ä¸” Auto.js ä¹Ÿå…è®¸æˆ‘ä»¬å®‰è£… npm åŒ…ã€‚

å› æ­¤å°½ç®¡æ˜¯ä¸€å¥—çœ‹ä¸Šå»æ›´ä¸ºå¤æ‚çš„å®ç°æ–¹æ¡ˆï¼Œä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥ã€Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šã€åˆç†åœ°ã€Œå·æ‡’ã€ï¼Œåœ¨ç¬¬ä¸‰æ–¹å¼€æºåŒ…çš„å¸®åŠ©ä¸‹èŠ‚çœç¼–ç¨‹æ—¶é—´ã€‚

### åˆ›å»º Auto.js é¡¹ç›®å¹¶å®‰è£…å¼€æºåŒ…

åœ¨æ¡Œé¢ç«¯ä¸Šä¸æ‰‹æœºç«¯çš„ Auto.js å»ºç«‹è¿æ¥ä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨ VS Code ä¸Šå¼€å§‹è¿›è¡Œä»£ç ç¼–å†™ï¼Œå…³äºå¦‚ä½•åœ¨æ¡Œé¢ç«¯ä½¿ç”¨ Auto.js çš„å…·ä½“æµç¨‹å¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°ã€‚

å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ Auto.js çš„ä»˜è´¹ç‰ˆæœ¬ï¼Œæ‰€ä»¥åœ¨ç”µè„‘ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¹‹åï¼Œç‚¹å‡» Auto.js Pro çš„æ’ä»¶å›¾æ ‡åå¹¶é€‰æ‹©ã€Œåˆ›å»º V9 API é¡¹ç›®ã€ç”¨ä»¥åœ¨æ–°å»ºçš„æ–‡ä»¶å¤¹ä¸­æ·»åŠ ç›¸å…³æ–‡ä»¶ï¼Œè¿™ä¹ŸåŒ…æ‹¬å¸¸è§çš„ `package.json` å¼€æºåŒ…ç®¡ç†æ–‡ä»¶ã€‚

æ‰€ä»¥åˆå§‹åŒ–åçš„æ–‡ä»¶å¤¹ä¸­åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š

```
timetracker
â”œâ”€â”€ node_modules
â”œâ”€â”€ main.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ project.json
â””â”€â”€ tsconfig.json


```

å‚è€ƒ Toggl API æ–‡æ¡£ç»™å‡ºçš„[å‚è€ƒæ–‡æ¡£](https://developers.track.toggl.com/docs/next/third_parties)ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±é€‰æ‹©å¼€æºç¤¾åŒºçš„ä¸åŒç¼–ç¨‹è¯­è¨€çš„ Toggl API ç‰ˆæœ¬ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke6db34tcdb5tu4rg)

ç”±äº Auto.js ç”¨çš„æ˜¯ JavaScript ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿå°±å¯¹åº”çš„æ˜¯æ–‡æ¡£ä¸­çš„ Node.js éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘å°±é€‰æ‹©äº†ç¬¬ä¸€é¡¹åä¸º [toggl-track](https://github.com/garyhtou/toggl-track) çš„ç¬¬ä¸‰æ–¹å®ç°ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨ç”µè„‘ç«¯è¿›è¡Œå®‰è£…æ‰€é€‰çš„ç¬¬ä¸‰æ–¹å¼€æºåŒ…ï¼Œæ‰€ä»¥è¯·ç¡®ä¿ä½ çš„å½“å‰æ“ä½œç³»ç»Ÿä¸­å®‰è£…äº† [Node.js ç¯å¢ƒ](https://nodejs.org/en/)ï¼Œå®ƒä¼šè‡ªå¸¦ä¸€ä¸ª `npm` å®‰è£…å·¥å…·ï¼Œæ¥ç€æˆ‘ä»¬åˆ‡æ¢åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯”å¦‚å‰é¢çš„ `timetracker`ï¼Œç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤å®Œæˆå®‰è£…æ­¥éª¤ï¼š

```
npm install --no-bin-links toggl-track


```

> æ³¨ï¼šç”±äº npm çš„æœåŠ¡å™¨æ˜¯åœ¨å›½å¤–ï¼Œä¸ºäº†åŠ é€Ÿä¸‹è½½å¯èƒ½éœ€è¦æˆ‘ä»¬é…ç½®ä¸€ä¸‹å›½å†…é•œåƒæºåœ°å€ï¼Œå…·ä½“å¯å‚è€ƒ npmmirror ä¸­å›½é•œåƒç«™çš„[ä½¿ç”¨è¯´æ˜](https://npmmirror.com/)ã€‚

ä¹‹åå½“æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šç¼–å†™å¥½ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å†æ¬¡ç‚¹å‡» Auto.js å›¾æ ‡ï¼Œå¹¶é€‰æ‹©ã€Œä¿å­˜é¡¹ç›®åˆ°è®¾å¤‡ã€ä¸€é¡¹ï¼Œå°†å½“å‰æ–‡ä»¶å¤¹çš„æ‰€æœ‰å†…å®¹å‘é€è‡³æ‰‹æœºï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿è„šæœ¬ä»£ç èƒ½åœ¨æ‰‹æœºä¸Šç›´æ¥è¿è¡Œã€‚æ¯æ¬¡ç‚¹å‡»è¯¥é€‰é¡¹æ—¶æ¡Œé¢ç«¯æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹éƒ½ä¼š**ç›´æ¥è¦†ç›–**æ‰‹æœºç«¯ä¸Šçš„åŒåæ–‡ä»¶å¤¹å†…å®¹ã€‚

ä¸è¿‡ç”±äºæˆ‘ä»¬çš„è‡ªåŠ¨è®¡æ—¶è„šæœ¬ä¹Ÿæ˜¯å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œåœ¨åç»­ä»£ç ä¸­æˆ‘ä»¬åªä¼šç”¨å¼•ç”¨åˆ°å®‰è£…åŒ…çš„å†…å®¹ï¼Œè€Œä¸ä¼šç”¨åˆ° `main.js` ä»£ç æ–‡ä»¶ï¼Œè®©å…¶ä¿æŒé»˜è®¤å³å¯ã€‚

### å°è£…ä¸ Toggl API äº¤äº’çš„æ¨¡å—

è™½ç„¶ toggl-track å°è£…äº†è®¸å¤šå‘ Toggl API å‘é€è¯·æ±‚çš„åŠŸèƒ½å‡½æ•°ï¼Œä½†å‡ºäºä¸ªäººéœ€è¦æˆ‘ä»¬å¯ä»¥å†åŸºäºæ­¤è¿›è¡Œç®€å•åœ°å°è£…ã€‚

è€ƒè™‘åˆ° Auto.js ä»…ä»…åªè´Ÿè´£æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼ŒåŠ ä¹‹åœæ­¢è®¡æ—¶å¯èƒ½ä¹Ÿä¼šç”¨åˆ° Toggl APIï¼Œæ‰€ä»¥æˆ‘å°±é¢å¤–å•ç‹¬å°è£…äº†ä¸€ä¸ªåä¸º `toggl.js` çš„è‡ªç”¨è„šæœ¬æ¨¡å—æ–¹ä¾¿åç»­è¢«å…¶ä»–è„šæœ¬æ‰€ä½¿ç”¨ï¼š

```
'nodejs';
const { Toggl } = require('toggl-track');

class TogglClient {
  constructor({ token = null } = {}) {
    if (!token) {
      throw new Error('invalid token');
    }

    this._toggl = new Toggl({
      auth: {
        token: token,
      },
    });
  }

  async _getWorkspaceId() {
    const resp = await this._toggl.me.get();
    return resp.default_workspace_id;
  }

  async start(
    name,
    { projectId = null, tags = null, workspace_id = null } = {}
  ) {
    if (!workspace_id) {
      workspace_id = await this._getWorkspaceId();
    }

    const currentTimeEntry = await this._toggl.timeEntry.current();
    if (currentTimeEntry && currentTimeEntry.description === name) {
      console.log('duplicated. time entry has started.');
      return;
    }

    let start = new Date();
    const body = {
      created_with: 'Autojs', // ID
      description: name, // Description
      workspace_id: workspace_id, // Workspace ID
      start: start.toISOString(), // Start date time
      duration: -Math.floor(start / 1000), // transform seconds
      project_id: projectId,
      tags: tags,
    };
    const resp = await this._toggl.timeEntry.create(workspace_id, body);
    if (typeof resp === 'string') {
      const err = JSON.stringify(resp);
      console.error(`something wrong when creating time entry, resp: ${err}`);
      return;
    }
    console.log(`time entry<name=${resp.description}>`);
  }

  async stop() {
    const currentTimeEntry = await this._toggl.timeEntry.current();
    if (!currentTimeEntry) {
      console.log("there isn't any time entry.");
      return;
    }

    const {
      id: entryId,
      description: name,
      workspace_id,
      at,
    } = currentTimeEntry;
    const start = new Date(at);
    const now = new Date();

    const body = {
      stop: now.toISOString(),
      duration: Math.floor((now - start) / 1000),
    };

    await this._toggl.timeEntry.update(entryId, workspace_id, body);
    console.log(`stop time entry <${name}>`);
  }
}

const defaultClient = new TogglClient({
  token: '<your-toggl-token>',
});
module.exports = {
  defaultClient,
  TogglClient,
};


```

ä¸Šè¿°è™½ç„¶ä»£ç çœ‹èµ·æ¥å¾ˆå¤šï¼Œå¯å¯¹äºæœ‰ JavaScript ç¼–ç¨‹ç»éªŒçš„äººæ¥è¯´å¯èƒ½å·²ç»ã€Œè§ç çŸ¥æ„ã€ï¼Œæ— éœ€å¤šè¨€ï¼›ä½†å¯¹äºæ²¡æœ‰ç¼–ç¨‹ç»éªŒçš„è¯»è€…è€Œè¨€æˆ‘è¿˜æ˜¯éœ€è¦å•°å—¦å‡ å¥ã€‚

ç®€å•æ¥è¯´ï¼Œä¸ºäº†è®©ä»£ç èƒ½å¤Ÿè¿è¡Œï¼Œéœ€è¦æˆ‘ä»¬å¡«å…¥ Toggl åº”ç”¨çš„æˆæƒ Tokenï¼Œä¹‹åæ¯æ¬¡åœ¨è¯·æ±‚ API æ—¶éƒ½ä¼šç”¨åˆ°è¯¥æˆæƒçš„ Tokenã€‚

é‚£ä¹ˆå¦‚ä½•è·å– Toggl Tokenï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰“å¼€ç™»å½•ç½‘é¡µç«¯çš„ Toggl ä¹‹åç‚¹å‡»å·¦ä¸‹è§’çš„ã€ŒProfileã€å¤´åƒéƒ¨åˆ†ï¼Œå†é€‰æ‹©ã€ŒProfile Settingsã€ï¼Œæœ€åä¸‹æ‹‰è‡³ã€ŒAPI Tokenã€å¤„ç‚¹å‡»å¹¶å¤åˆ¶å³å¯ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke6lb34tcd6q36fc0)

é™¤æ­¤ä¹‹å¤–å°±æ˜¯é¢å¤–å°è£…äº†ä¸¤ä¸ªæ–¹æ³• `start()` å’Œ `stop()` ç”¨ä»¥åº”å¯¹å¼€å§‹è®¡æ—¶å’Œåœæ­¢è®¡æ—¶ä¸¤ä¸ªè¡Œä¸ºï¼ŒäºŒè€…çš„æ ¸å¿ƒé€»è¾‘ç±»ä¼¼ï¼š

1.  é¦–å…ˆåˆ¤æ–­æ˜¯å¦ Toggl å·²ç»æ­£åœ¨è®¡æ—¶ï¼Œç”šè‡³è®¡æ—¶çš„ä»»åŠ¡åç§°ä¸å½“å‰çš„ä»»åŠ¡åç§°ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¿›è¡Œé¢å¤–è¯·æ±‚ API çš„æ“ä½œï¼Œä»…ä»…åªæ˜¯è¾“å‡ºä¸€ä¸‹æ—¥å¿—æç¤ºå³è·³è¿‡ï¼›
2.  é™¤æ­¤ä¹‹å¤–ï¼Œå°±ä¼šæŒ‰ç…§ Toggl API çš„å®˜æ–¹è¦æ±‚å°†è¯·æ±‚éœ€è¦å‘é€çš„æ•°æ®è¿›è¡ŒåŒ…è£…å¹¶å‘é€å¯¹åº”æ“ä½œçš„è¯·æ±‚ã€‚

ç´§æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–°å»ºè„šæœ¬å¹¶å¼•ç”¨å°è£…å¥½çš„å†…å®¹ã€‚ç”±äºæˆ‘å·²ç»äº‹å…ˆåŸºäºè‡ªå·±çš„ Toggl åº”ç”¨ Token åˆ›å»ºäº†ä¸€ä¸ª `defaultClient`ï¼Œå› æ­¤æˆ‘å°±æ— éœ€å†ä¼ å…¥ä¸€æ¬¡ Token è€Œç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘å°†å¼€å§‹è®¡æ—¶çš„ä»£ç å‘½åä¸º `startReader.js`ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š

```
'nodejs';
// --------------------
// Auto.js built-in
// --------------------

const { currentPackage } = require('accessibility');
const { getAppName } = require('app');
const { showToast } = require('toast');

// --------------------
// Internal
// --------------------

const { defaultClient } = require('./toggl');

// --------------------

(async () => {
  let packageName = currentPackage();
  let appName = getAppName(packageName);

  console.log(`${packageName}, ${appName}`);

  const READER_APP_NAMES = ['äº¬ä¸œè¯»ä¹¦', 'å¾®ä¿¡è¯»ä¹¦', 'Raindrop'];
  if (!READER_APP_NAMES.includes(appName)) {
    console.log(`${appName} isn't in target reader app list.`);
    return;
  }

  await defaultClient.start(appName, { projectId: '<your-project-id>' });
  showToast('å¼€å§‹æ—¶é—´è®°å½•');
})();


```

åœ¨è¿™æ®µä»£ç ä¸­æˆ‘è¿˜ä¼šä½¿ç”¨åˆ° Auto.js å†…ç½®çš„ä¸€äº›æ¨¡å—è¿›è¡Œç”¨äºé¢å¤–çš„åˆ¤æ–­é€»è¾‘è¾…åŠ©ï¼šæˆ‘ä¼šå…ˆè·å–åˆ°å½“å‰å‰å°çš„åº”ç”¨æ˜¯å¦ä¸ºæˆ‘å¸¸ç”¨çš„å‡ ä¸ªé˜…è¯»ç±»åº”ç”¨ï¼Œå¦‚æœä¸æ˜¯é‚£ä¹ˆå°±ç®€å•è¾“å‡ºä¸€ä¸‹æç¤ºä¿¡æ¯åˆ™ä¸åšå…¶ä»–å¤„ç†ï¼›åä¹‹ï¼Œåˆ™è°ƒç”¨å‰é¢å°è£…å¥½çš„ `start()` æ–¹æ³•å¼€å§‹è®¡æ—¶ã€‚

å…¶ä¸­çš„ä»»åŠ¡åç§°å‚æ•°ä¸ºåº”ç”¨åç§°ï¼Œå¹¶ä¸”æˆ‘è¿˜å¡«å…¥äº†è‡ªå·±é€šå¸¸ç”¨äºè®°å½•é˜…è¯»ç±»ä»»åŠ¡çš„é¡¹ç›®ç»„ IDï¼Œä½ å¦‚æœæ²¡æœ‰é‚£ä¹ˆå¯ä»¥ä¿æŒä¸ºç©ºã€‚

ç±»ä¼¼åœ°ï¼Œåœæ­¢è®¡æ—¶çš„è„šæœ¬ä»£ç  `stopReader.js` å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œä½†ç›¸æ¯”äºå¼€å§‹è®¡æ—¶çš„è„šæœ¬æ¥è¯´æˆ‘ä»¬åˆ™ä¸éœ€è¦é¢å¤–çš„åˆ¤æ–­ï¼š

```
'nodejs';
// --------------------
// Auto.js built-in
// --------------------

const { showToast } = require('toast');

// --------------------
// Internal
// --------------------

const { defaultClient } = require('./toggl');

// --------------------

(async () => {
  await defaultClient.stop();
  showToast('ç»“æŸè®°å½•æ—¶é—´');
})();


```

è‡³æ­¤ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»å®Œæˆäº† Auto.js çš„éƒ¨åˆ†ï¼Œç°åœ¨åªéœ€è¦ä¸ºå…¶æ·»åŠ ç›¸åº”çš„è§¦å‘æœºåˆ¶å³å¯ï¼Œæ­¤æ—¶ `timetracker` æ–‡ä»¶å¤¹çš„å†…å®¹åˆä¸°å¯Œäº†ä¸å°‘ï¼š

```
timetracker
â”œâ”€â”€ main.js
â”œâ”€â”€ node_modules
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ project.json
â”œâ”€â”€ startReader.js
â”œâ”€â”€ stopReader.js
â”œâ”€â”€ toggl.js
â””â”€â”€ tsconfig.json


```

ç„¶åå†æ¬¡é€šè¿‡ã€Œä¿å­˜é¡¹ç›®åˆ°è®¾å¤‡ã€é€‰é¡¹æ¥ç¡®ä¿æ‰‹æœºç«¯ä¸Šçš„ä»£ç æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚

ä¸è¿‡ç”±äº Auto.js ä¸­æ¡ä»¶è§¦å‘ç›¸å…³çš„ API è¾ƒä¸ºç¨€ç¼ºï¼Œå› æ­¤æˆ‘å°±å€ŸåŠ©äº† MacroDroid æ¥è¡¥é½æœ€åä¸€å—çŸ­æ¿ã€‚

ä½¿ç”¨ MacroDroid æ·»åŠ è§¦å‘æ¡ä»¶
--------------------

åœ¨ MacroDroid ä¸­æˆ‘ä»¬éœ€è¦æ–°å»ºä¸¤ä¸ªå®åˆ†åˆ«è°ƒç”¨å¼€å§‹è®¡æ—¶ä¸åœæ­¢è®¡æ—¶çš„è„šæœ¬ï¼Œè¿™é‡Œçš„å®å°±ç›¸å½“äºæˆ‘ä»¬çš„è‡ªåŠ¨åŒ–æµç¨‹é›†åˆï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªå®ä¹‹ä¸­è¿›è¡Œç®¡ç†ã€‚

å› ä¸ºå¼€å§‹è®¡æ—¶ä¸åœæ­¢è®¡æ—¶çš„è¡Œä¸ºé€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬å°èŠ‚ä»…ä»¥å¼€å§‹è®¡æ—¶ä¸ºä¾‹è€Œä¸å†èµ˜è¿°åœæ­¢è®¡æ—¶çš„å®åˆ›å»ºè¿‡ç¨‹ã€‚

è¿›å…¥åˆ° MacroDroid ä¸»é¡µä¹‹åæˆ‘ä»¬å¯ä»¥ç‚¹å‡»é€‰é¡¹å¡ä¸­çš„ã€Œæ·»åŠ å®ã€æ¨¡å—æ¥åˆ›å»ºå®ã€‚åœ¨ MacroDroid çš„å®ç•Œé¢é‡Œï¼Œé™¤äº†å®åç§°ä¹‹å¤–ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ†åˆ«å¯¹ã€Œè§¦å‘å™¨ã€å’Œã€ŒåŠ¨ä½œã€ä¸¤ä¸ªé€‰é¡¹è¿›è¡Œè®¾ç½®å³å¯å®Œæˆå®çš„åˆ›å»ºã€‚

![](https://cdn.sspai.com/editor/u_/cdlke6tb34tcd6q36fcg)

ç‚¹å‡»è§¦å‘å™¨åŒºåŸŸå³ä¸Šè§’çš„åŠ å·åï¼Œæˆ‘ä»¬é€‰æ‹©ã€Œåº”ç”¨ç¨‹åºã€ä¸€é¡¹ï¼Œç„¶åå†ç‚¹å‡»ã€Œåº”ç”¨æ‰“å¼€ / å…³é—­ã€å¹¶é€‰æ‹©ã€Œåº”ç”¨æ‰“å¼€ã€çš„é€‰é¡¹å¹¶ç¡®å®šï¼Œä¹‹åæˆ‘ä»¬å†é€‰æ‹©ã€Œé€‰æ‹©åº”ç”¨ã€ä¸€é¡¹æ¥æ ¹æ®åç§°é€‰æ‹©åˆ™ç›®æ ‡åº”ç”¨ï¼Œé€‰æ‹©å®Œæ¯•å³å¯ç‚¹å‡»ç¡®è®¤è¿›è€Œå®Œæˆè§¦å‘å™¨çš„è®¾ç½®å¹¶å›åˆ°å®ç•Œé¢ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke75b34tcdtg9f30g)

ç´§æ¥ç€å†ä»¥ç±»ä¼¼çš„æ“ä½œè®¾ç½®ã€ŒåŠ¨ä½œã€ã€‚å…·ä½“è€Œè¨€å°±æ˜¯ï¼šåŒæ ·æ‰¾åˆ°ã€Œåº”ç”¨ç¨‹åºã€ä¸€é¡¹ï¼Œç„¶åç‚¹å‡»ã€ŒTasker / æœ¬åœ°æ’ä»¶ã€é€‰é¡¹ï¼Œæ‰¾åˆ°å¹¶é€‰æ‹© Auto.js çš„æ’ä»¶ï¼Œä¹‹åæ ¹æ® Auto.js é»˜è®¤çš„è„šæœ¬å­˜å‚¨è·¯å¾„ï¼ˆé»˜è®¤ä¸ºç³»ç»Ÿæ–‡ä»¶å¤¹ä¸‹çš„ã€Œè„šæœ¬ã€æ–‡ä»¶å¤¹ï¼‰æ‰¾åˆ°å¯¹åº”çš„è„šæœ¬ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke7db34tcdb5tu4s0)

å®Œæˆä»¥ä¸Šæ­¥éª¤åæˆ‘ä»¬å°±å¯ä»¥ç‚¹å‡»å®ç•Œé¢å³ä¸‹è§’çš„æŒ‰é’®å¯¹å…¶è¿›è¡Œä¿å­˜ï¼Œä¿å­˜çš„å®å°†ä¼šåœ¨ MacroDroid çš„ã€Œå®ã€é€‰é¡¹å¡ä¸­å±•ç¤ºï¼ˆé»˜è®¤ä¸ºã€Œæœªåˆ†ç±»ã€ç»„ï¼‰ï¼Œä¹‹åæˆ‘ä»¬ç¡®ä¿è¯¥å®å¤„äºå¯åŠ¨çŠ¶æ€å³å¯ã€‚

![](https://cdn.sspai.com/editor/u_/cdlke7lb34tcdb5tu4sg)

å½“ç„¶æœ€åè¿˜è¦è®°å¾—ä¸º MacroDroid åŠ ä¸Šå¯¹åº”çš„æ— éšœç¢æƒé™ã€é”å®šåå°ä»¥åŠå…³é—­ç”µæ± ä¼˜åŒ–ç­‰è®¾ç½®ï¼Œé¿å… MacroDroid è¿›ç¨‹è¢«æ€æ‰ã€‚

å°¾å·´
--

ä»¥ä¸Šæ­¥éª¤å®Œæˆåï¼Œå°±å¯ä»¥å®£å‘Šæˆ‘ä»¬çš„è‡ªåŠ¨åŒ–æµç¨‹å¤§åŠŸå‘Šæˆï¼Œæœ€ç»ˆæ•ˆæœæˆ‘ä»¬åœ¨å¼€å¤´å·²ç»å±•ç¤ºè¿‡äº†ï¼Œç°åœ¨ä½ å¯ä»¥å†è·³å›å»çœ‹çœ‹ã€‚

ä¸è¿‡åœ¨æˆ‘å®é™…çš„å¤šæ¬¡ä½¿ç”¨ä¸­ï¼Œå‘ç° MacroDroid çš„è§¦å‘å™¨æœºåˆ¶å¯èƒ½å°±æ¯”è¾ƒç®€å•ç²—æš´ï¼Œä¼šå‡ºç°å¤šæ¬¡çŸ­æš‚è®¡æ—¶çš„æƒ…å†µã€‚å¦‚æœæˆ‘åˆ‡å‡ºå¹¶æŒ‚èµ·åº”ç”¨æ—¶ï¼Œä¼šè§¦å‘ MacroDroid çš„ã€Œåº”ç”¨å…³é—­ã€å¯¼è‡´ç›´æ¥åœæ­¢è®¡æ—¶ï¼›ç±»ä¼¼åœ°ï¼Œå½“æˆ‘ä»åå°å”¤é†’åº”ç”¨æ—¶ä¹Ÿä¼šè§¦å‘ MacroDroid çš„ã€Œåº”ç”¨æ‰“å¼€ã€å¹¶è°ƒç”¨å¼€å§‹è®¡æ—¶è„šæœ¬ã€‚

å¯ä»æŸä¸ªè§’åº¦æ¥çœ‹ä¼¼ä¹ä¹Ÿåˆç†ï¼Œå› ä¸ºå½“æˆ‘ä»¬åˆ‡å‡ºå½“å‰åº”ç”¨æ—¶ä¹Ÿè¯´æ˜æˆ‘ä»¬æ­¤æ—¶å¹¶ä¸æ˜¯çœŸæ­£åœ°åœ¨é˜…è¯»æˆ–ä½¿ç”¨è¯¥åº”ç”¨ï¼Œè€Œé‡æ–°å”¤é†’å¹¶è¿›å…¥åˆ°åº”ç”¨åˆ™è¯´æ˜æˆ‘ä»¬åˆå¼€å§‹ä½¿ç”¨ï¼Œåº”å½“é‡æ–°å¼€å§‹è®¡æ—¶ã€‚

æ‰€ä»¥è¿™çœ‹ä¼¼ã€ŒBugã€çš„ã€ŒFeatureã€ä¹Ÿè®©æˆ‘æ›´åŠ ä¸“æ³¨äºé˜…è¯»ï¼Œè€Œä¸å®¹æ˜“ä¸ºå…¶ä»–æ— å…³ç´§è¦çš„æ¶ˆæ¯é€šçŸ¥æ‰€åˆ†ç¥ã€‚

> ä¸‹è½½ [å°‘æ•°æ´¾ 2.0 å®¢æˆ·ç«¯](https://sspai.com/page/client)ã€å…³æ³¨ [å°‘æ•°æ´¾å…¬ä¼—å·](https://sspai.com/s/J71e)ï¼Œè§£é”å…¨æ–°é˜…è¯»ä½“éªŒ ğŸ“°

> å®ç”¨ã€å¥½ç”¨çš„ [æ­£ç‰ˆè½¯ä»¶](https://sspai.com/mall)ï¼Œå°‘æ•°æ´¾ä¸ºä½ å‘ˆç° ğŸš€